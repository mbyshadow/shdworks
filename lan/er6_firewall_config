


configure

set firewall all-ping disable
set firewall broadcast-ping disable
set firewall ipv6-receive-redirects disable
set firewall ipv6-src-route disable
set firewall ip-src-route disable
set firewall log-martians enable

set firewall name WAN_IN default-action drop
set firewall name WAN_IN description 'WAN to internal'

set firewall name WAN_IN rule 10 action accept
set firewall name WAN_IN rule 10 description 'Allow established/related'
set firewall name WAN_IN rule 10 state established enable
set firewall name WAN_IN rule 10 state related enable

set firewall name WAN_IN rule 20 action drop
set firewall name WAN_IN rule 20 description 'Drop invalid state'
set firewall name WAN_IN rule 20 state invalid enable

set firewall name WAN_LOCAL default-action drop
set firewall name WAN_LOCAL description 'WAN to router'

set firewall name WAN_LOCAL rule 10 action accept
set firewall name WAN_LOCAL rule 10 description 'Allow established/related'
set firewall name WAN_LOCAL rule 10 state established enable
set firewall name WAN_LOCAL rule 10 state related enable

set firewall name WAN_LOCAL rule 20 action drop
set firewall name WAN_LOCAL rule 20 description 'Drop invalid state'
set firewall name WAN_LOCAL rule 20 state invalid enable

set firewall receive-redirects disable
set firewall send-redirects enable
set firewall source-validation disable
set firewall syn-cookies enable

commit ; save ; exit
exit





configure

 set service nat rule 110 description 'DNAT rule: VLAN10 DNS requests forced to router'
 set service nat rule 110 destination address '!10.0.10.1'
 set service nat rule 110 destination port 53
 set service nat rule 110 inbound-interface eth2.10
 set service nat rule 110 inside-address address 10.0.10.1
 set service nat rule 110 log enable
 set service nat rule 110 protocol tcp_udp
 set service nat rule 100 type destination

 set service nat rule 120 description 'DNAT rule: VLAN20 DNS requests forced to router'
 set service nat rule 120 destination address '!10.0.20.1'
 set service nat rule 120 destination port 53
 set service nat rule 120 inbound-interface eth2.20
 set service nat rule 120 inside-address address 10.0.20.1
 set service nat rule 120 log enable
 set service nat rule 120 protocol tcp_udp
 set service nat rule 120 type destination

 set service nat rule 130 description 'DNAT rule: VLAN30 DNS requests forced to router'
 set service nat rule 130 destination address '!10.0.30.1'
 set service nat rule 130 destination port 53
 set service nat rule 130 inbound-interface eth3.30
 set service nat rule 130 inside-address address 10.0.30.1
 set service nat rule 130 log enable
 set service nat rule 130 protocol tcp_udp
 set service nat rule 130 type destination

 set service nat rule 140 description 'DNAT rule: VLAN40 DNS requests forced to router'
 set service nat rule 140 destination address '!10.0.40.1'
 set service nat rule 140 destination port 53
 set service nat rule 140 inbound-interface eth3.40
 set service nat rule 140 inside-address address 10.0.40.1
 set service nat rule 140 log enable
 set service nat rule 140 protocol tcp_udp
 set service nat rule 140 type destination

 commit
 save
 exit




configure

 set service nat rule 100 description 'DNAT rule: VLAN100 DNS requests forced to router'
 set service nat rule 100 destination address '!192.168.100.1'
 set service nat rule 100 destination port 53
 set service nat rule 100 inbound-interface eth1.100
 set service nat rule 100 inside-address address 192.168.100.1
 set service nat rule 100 log enable
 set service nat rule 100 protocol tcp_udp
 set service nat rule 100 type destination

 set service nat rule 102 description 'DNAT rule: VLAN102 DNS requests forced to router'
 set service nat rule 102 destination address '!192.168.102.1'
 set service nat rule 102 destination port 53
 set service nat rule 102 inbound-interface eth2.102
 set service nat rule 102 inside-address address 192.168.102.1
 set service nat rule 102 log enable
 set service nat rule 102 protocol tcp_udp
 set service nat rule 102 type destination

 set service nat rule 103 description 'DNAT rule: VLAN103 DNS requests forced to router'
 set service nat rule 103 destination address '!192.168.103.1'
 set service nat rule 103 destination port 53
 set service nat rule 103 inbound-interface eth2.103
 set service nat rule 103 inside-address address 192.168.103.1
 set service nat rule 103 log enable
 set service nat rule 103 protocol tcp_udp
 set service nat rule 103 type destination

 set service nat rule 107 description 'DNAT rule: VLAN107 DNS requests forced to router'
 set service nat rule 107 destination address '!192.168.107.1'
 set service nat rule 107 destination port 53
 set service nat rule 107 inbound-interface eth2.107
 set service nat rule 107 inside-address address 192.168.107.1
 set service nat rule 107 log enable
 set service nat rule 107 protocol tcp_udp
 set service nat rule 107 type destination

 commit
 save
 exit



configure

set firewall name GUEST_IN default-action accept

set firewall name GUEST_IN rule 10 action accept
set firewall name GUEST_IN rule 10 description webserver
set firewall name GUEST_IN rule 10 log disable
set firewall name GUEST_IN rule 10 protocol tcp
set firewall name GUEST_IN rule 10 destination port 80,443
set firewall name GUEST_IN rule 10 destination address 10.0.10.10

set firewall name GUEST_IN rule 20 action drop
set firewall name GUEST_IN rule 20 description other
set firewall name GUEST_IN rule 20 log disable
set firewall name GUEST_IN rule 20 protocol all
set firewall name GUEST_IN rule 20 destination address 10.0.10.0/24

set firewall name GUEST_LOCAL default-action drop

set firewall name GUEST_LOCAL rule 10 action accept
set firewall name GUEST_LOCAL rule 10 description 'allow dns'
set firewall name GUEST_LOCAL rule 10 log disable
set firewall name GUEST_LOCAL rule 10 protocol tcp_udp
set firewall name GUEST_LOCAL rule 10 destination port 53

set firewall name GUEST_LOCAL rule 20 action accept
set firewall name GUEST_LOCAL rule 20 description 'allow dhcp'
set firewall name GUEST_LOCAL rule 20 log disable
set firewall name GUEST_LOCAL rule 20 protocol udp
set firewall name GUEST_LOCAL rule 20 destination port 67

set interfaces ethernet eth1 vif 20 firewall in name GUEST_IN
set interfaces ethernet eth1 vif 20 firewall local name GUEST_LOCAL
